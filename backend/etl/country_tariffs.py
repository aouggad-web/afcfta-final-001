"""
Tarifs douaniers officiels pour tous les pays africains membres de la ZLECAf
Sources: OMC, Banque Mondiale WITS, CNUCED TRAINS, Administrations douanières nationales
Dernière mise à jour: Janvier 2025

STRUCTURE DES TARIFS RÉGIONAUX:
- CEDEAO (TEC): 0%, 5%, 10%, 20%, 35%
- CEMAC (TEC): 0%, 5%, 10%, 20%, 30% (harmonisé CEMAC-CEEAC depuis 2024, jusqu'à 40%)
- EAC (TEC): 0%, 10%, 25%, 35%
- SACU: 0% à 45% (variable)
- Afrique du Nord: Tarifs nationaux variables
"""

from typing import Dict, Optional, List

# =============================================================================
# AFRIQUE DU NORD - TARIFS NATIONAUX
# =============================================================================

# ALGÉRIE - 4 taux principaux: 30%, 15%, 5%, 0%
# Source: Direction Générale des Douanes (DGD) - douane.gov.dz
# Note: DAPS (30-200%) sur 1095 produits spécifiques non inclus ici
ALGERIA_TARIFFS = {
    "30": ["04", "16", "17", "19", "20", "21", "22", "24", "33", "34", "42", "61", "62", "63", "64", "65", "69", "70", "71", "91", "92", "94", "95", "96"],
    "15": ["01", "02", "03", "05", "06", "07", "08", "09", "10", "11", "12", "13", "14", "15", "23", "32", "35", "36", "37", "38", "39", "40", "41", "43", "44", "45", "46", "47", "48", "49", "50", "51", "52", "53", "54", "55", "56", "57", "58", "59", "60", "66", "67", "68", "72", "73", "74", "75", "76", "78", "79", "80", "81", "82", "83"],
    "05": ["25", "26", "27", "28", "29", "30", "31", "84", "85", "86", "87", "88", "89", "90", "93"],
    "00": []
}

# MAROC - Taux: 40%, 25%, 17.5%, 10%, 2.5%, 0%
# Source: ADII - Moyenne MFN 12.3% (2024)
MOROCCO_TARIFFS = {
    "40": ["22", "24"],
    "25": ["04", "16", "17", "19", "20", "21", "33", "61", "62", "63", "64", "94", "95"],
    "17.5": ["01", "02", "03", "07", "08", "09", "15", "39", "40", "42", "44", "48", "69", "70", "72", "73", "76", "82", "83"],
    "10": ["06", "10", "11", "12", "23", "28", "29", "32", "35", "38", "47", "50", "51", "52", "53", "54", "55", "56", "57", "58", "59", "60", "68", "74", "75"],
    "2.5": ["25", "26", "27", "30", "31", "84", "85", "86", "87", "88", "89", "90"],
    "00": []
}

# TUNISIE - Moyenne MFN 19.4% (2024)
# Taux: jusqu'à 200% pour certains produits, standard 7-50%
TUNISIA_TARIFFS = {
    "50": ["22", "24"],  # Boissons alcoolisées, tabacs
    "43": ["33", "61", "62", "64", "94"],  # Cosmétiques, vêtements, meubles
    "36": ["04", "16", "17", "19", "20", "21", "71", "91", "95"],  # Produits alimentaires transformés
    "30": ["42", "63", "65", "69", "70"],
    "20": ["01", "02", "03", "07", "08", "09", "15", "39", "40", "44", "48", "57", "72", "73", "76", "82", "83", "87"],
    "10": ["06", "10", "11", "12", "23", "32", "35", "38", "47", "50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "68", "74", "75", "84", "85", "86", "88", "89", "90"],
    "00": ["25", "26", "27", "28", "29", "30", "31"]
}

# ÉGYPTE - Taux: 2% à 60%
# Source: Egyptian Customs Authority, FEI
EGYPT_TARIFFS = {
    "60": ["22", "24"],  # Alcool, tabac
    "40": ["33", "61", "62", "64", "71", "91", "95"],  # Luxe, vêtements
    "30": ["04", "16", "17", "19", "20", "21", "42", "63", "65", "69", "70", "94"],
    "22": ["39", "40", "44", "48", "57", "72", "73", "76", "82", "83"],  # Biens de consommation non durables
    "12": ["50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "68", "74", "75"],  # Biens intermédiaires
    "05": ["84", "85", "86", "88", "89", "90"],  # Biens d'équipement
    "02": ["01", "02", "03", "06", "07", "08", "09", "10", "11", "12", "15", "23", "25", "26", "27", "28", "29", "30", "31", "32", "35", "38", "47", "87"],
    "00": []
}

# LIBYE
LIBYA_TARIFFS = {
    "40": ["22", "24"],
    "25": ["04", "16", "17", "19", "20", "21", "33", "61", "62", "63", "64", "94", "95"],
    "15": ["01", "02", "03", "07", "08", "09", "15", "39", "40", "42", "44", "48", "57", "69", "70", "72", "73", "76", "82", "83"],
    "05": ["25", "26", "27", "28", "29", "30", "31", "84", "85", "86", "87", "88", "89", "90"],
    "00": ["06", "10", "11", "12", "23", "32", "35", "38", "47", "50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "68", "74", "75"]
}

# MAURITANIE
MAURITANIA_TARIFFS = {
    "20": ["22", "24", "33", "61", "62", "64", "94", "95"],
    "15": ["04", "16", "17", "19", "20", "21", "42", "63", "69", "70", "71"],
    "10": ["01", "02", "03", "07", "08", "09", "15", "39", "40", "44", "48", "57", "72", "73", "76", "82", "83"],
    "05": ["06", "10", "11", "12", "23", "25", "26", "27", "28", "29", "30", "31", "32", "35", "38", "47", "50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "68", "74", "75", "84", "85", "86", "87", "88", "89", "90"],
    "00": []
}

# =============================================================================
# AFRIQUE DE L'OUEST - TEC CEDEAO (5 bandes: 0%, 5%, 10%, 20%, 35%)
# Source: ECOWAS ECOTIS - ecotis.ecowas.int
# =============================================================================

ECOWAS_TEC = {
    "35": ["22", "24", "33", "61", "62", "64", "71", "91", "94", "95"],  # Biens spécifiques pour le développement économique
    "20": ["01", "02", "03", "04", "07", "08", "09", "15", "16", "17", "19", "20", "21", "39", "40", "42", "44", "48", "57", "63", "65", "69", "70", "72", "73", "76", "82", "83", "87"],  # Biens de consommation finale
    "10": ["06", "10", "11", "12", "23", "28", "29", "31", "32", "35", "38", "47", "50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "68", "74", "75"],  # Biens intermédiaires
    "05": ["25", "26", "27", "84", "85", "86", "88", "89", "90"],  # Matières premières, biens d'équipement
    "00": ["30"]  # Biens sociaux essentiels (médicaments)
}

# Tous les pays CEDEAO utilisent le TEC
BENIN_TARIFFS = ECOWAS_TEC
BURKINA_FASO_TARIFFS = ECOWAS_TEC
CAPE_VERDE_TARIFFS = ECOWAS_TEC
IVORY_COAST_TARIFFS = ECOWAS_TEC
GAMBIA_TARIFFS = ECOWAS_TEC
GHANA_TARIFFS = ECOWAS_TEC
GUINEA_TARIFFS = ECOWAS_TEC
GUINEA_BISSAU_TARIFFS = ECOWAS_TEC
LIBERIA_TARIFFS = ECOWAS_TEC
MALI_TARIFFS = ECOWAS_TEC
NIGER_TARIFFS = ECOWAS_TEC
NIGERIA_TARIFFS = ECOWAS_TEC
SENEGAL_TARIFFS = ECOWAS_TEC
SIERRA_LEONE_TARIFFS = ECOWAS_TEC
TOGO_TARIFFS = ECOWAS_TEC

# =============================================================================
# AFRIQUE CENTRALE - TEC CEMAC-CEEAC (0% à 40%)
# Source: CEMAC - Harmonisé octobre 2024
# =============================================================================

CEMAC_TEC = {
    "30": ["22", "24", "33", "61", "62", "64", "71", "91", "94", "95"],
    "20": ["01", "02", "03", "04", "07", "08", "09", "15", "16", "17", "19", "20", "21", "39", "40", "42", "44", "48", "57", "63", "65", "69", "70", "72", "73", "76", "82", "83", "87"],
    "10": ["06", "10", "11", "12", "23", "28", "29", "31", "32", "35", "38", "47", "50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "68", "74", "75"],
    "05": ["25", "26", "27", "30", "84", "85", "86", "88", "89", "90"],
    "00": []
}

# Pays CEMAC
CAMEROON_TARIFFS = CEMAC_TEC
CENTRAL_AFRICAN_REP_TARIFFS = CEMAC_TEC
CHAD_TARIFFS = CEMAC_TEC
CONGO_TARIFFS = CEMAC_TEC
EQUATORIAL_GUINEA_TARIFFS = CEMAC_TEC
GABON_TARIFFS = CEMAC_TEC

# =============================================================================
# AFRIQUE DE L'EST - TEC EAC (4 bandes: 0%, 10%, 25%, 35%)
# Source: EAC Online Tariff - eac.int
# =============================================================================

EAC_TEC = {
    "35": ["22", "24", "33", "61", "62", "64", "71", "91", "94", "95"],  # Produits sensibles
    "25": ["01", "02", "03", "04", "07", "08", "09", "15", "16", "17", "19", "20", "21", "39", "40", "42", "44", "48", "57", "63", "65", "69", "70", "72", "73", "76", "82", "83", "87"],  # Biens finis
    "10": ["06", "10", "11", "12", "23", "28", "29", "31", "32", "35", "38", "47", "50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "68", "74", "75"],  # Biens intermédiaires
    "00": ["25", "26", "27", "30", "84", "85", "86", "88", "89", "90"]  # Matières premières, équipements
}

# Pays EAC
BURUNDI_TARIFFS = EAC_TEC
KENYA_TARIFFS = EAC_TEC
RWANDA_TARIFFS = EAC_TEC
SOUTH_SUDAN_TARIFFS = EAC_TEC
TANZANIA_TARIFFS = EAC_TEC
UGANDA_TARIFFS = EAC_TEC
DRC_TARIFFS = EAC_TEC  # RDC membre EAC depuis 2022

# =============================================================================
# AFRIQUE AUSTRALE - SACU & SADC
# Source: SARS, SACU Tariff Board
# =============================================================================

# AFRIQUE DU SUD - SACU (0% à 45%, moyenne 7.8%)
SOUTH_AFRICA_TARIFFS = {
    "45": ["22", "24"],  # Alcool, tabac
    "40": ["61", "62"],  # Vêtements
    "30": ["64"],  # Chaussures
    "25": ["04", "16", "17", "19", "20", "21", "33", "42", "63", "65", "69", "70", "71", "91", "94", "95", "87"],  # Véhicules légers 25%
    "20": ["01", "02", "03", "07", "08", "09", "15", "39", "40", "44", "48", "57", "72", "73", "76", "82", "83"],
    "15": ["06", "10", "11", "12", "23", "32", "35", "38", "47", "50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "68", "74", "75"],
    "10": ["28", "29", "31"],
    "05": ["25", "26", "27", "84", "85", "86", "88", "89", "90"],
    "00": ["30"]
}

# Autres pays SACU (même tarif que ZA)
BOTSWANA_TARIFFS = SOUTH_AFRICA_TARIFFS
LESOTHO_TARIFFS = SOUTH_AFRICA_TARIFFS
NAMIBIA_TARIFFS = SOUTH_AFRICA_TARIFFS
ESWATINI_TARIFFS = SOUTH_AFRICA_TARIFFS

# ANGOLA
ANGOLA_TARIFFS = {
    "50": ["22", "24"],
    "30": ["33", "61", "62", "64", "71", "91", "94", "95"],
    "20": ["01", "02", "03", "04", "07", "08", "09", "15", "16", "17", "19", "20", "21", "39", "40", "42", "44", "48", "57", "63", "65", "69", "70", "72", "73", "76", "82", "83"],
    "10": ["06", "10", "11", "12", "23", "28", "29", "31", "32", "35", "38", "47", "50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "68", "74", "75"],
    "02": ["25", "26", "27", "30", "84", "85", "86", "87", "88", "89", "90"],
    "00": []
}

# MOZAMBIQUE
MOZAMBIQUE_TARIFFS = {
    "25": ["22", "24", "33", "61", "62", "64", "71", "91", "94", "95"],
    "20": ["01", "02", "03", "04", "07", "08", "09", "15", "16", "17", "19", "20", "21", "39", "40", "42", "44", "48", "57", "63", "65", "69", "70", "72", "73", "76", "82", "83", "87"],
    "7.5": ["06", "10", "11", "12", "23", "28", "29", "31", "32", "35", "38", "47", "50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "68", "74", "75"],
    "2.5": ["25", "26", "27", "30", "84", "85", "86", "88", "89", "90"],
    "00": []
}

# ZAMBIE
ZAMBIA_TARIFFS = {
    "40": ["22", "24"],
    "25": ["33", "61", "62", "64", "71", "91", "94", "95"],
    "15": ["01", "02", "03", "04", "07", "08", "09", "15", "16", "17", "19", "20", "21", "39", "40", "42", "44", "48", "57", "63", "65", "69", "70", "72", "73", "76", "82", "83", "87"],
    "05": ["06", "10", "11", "12", "23", "25", "26", "27", "28", "29", "30", "31", "32", "35", "38", "47", "50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "68", "74", "75", "84", "85", "86", "88", "89", "90"],
    "00": []
}

# ZIMBABWE
ZIMBABWE_TARIFFS = {
    "60": ["22", "24"],
    "40": ["33", "61", "62", "64", "71", "91", "94", "95"],
    "25": ["04", "16", "17", "19", "20", "21", "42", "63", "65", "69", "70"],
    "15": ["01", "02", "03", "07", "08", "09", "15", "39", "40", "44", "48", "57", "72", "73", "76", "82", "83", "87"],
    "05": ["06", "10", "11", "12", "23", "25", "26", "27", "28", "29", "30", "31", "32", "35", "38", "47", "50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "68", "74", "75", "84", "85", "86", "88", "89", "90"],
    "00": []
}

# MALAWI
MALAWI_TARIFFS = {
    "30": ["22", "24", "33", "61", "62", "64", "71", "91", "94", "95"],
    "20": ["01", "02", "03", "04", "07", "08", "09", "15", "16", "17", "19", "20", "21", "39", "40", "42", "44", "48", "57", "63", "65", "69", "70", "72", "73", "76", "82", "83", "87"],
    "10": ["06", "10", "11", "12", "23", "25", "26", "27", "28", "29", "31", "32", "35", "38", "47", "50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "68", "74", "75", "84", "85", "86", "88", "89", "90"],
    "00": ["30"]
}

# MADAGASCAR
MADAGASCAR_TARIFFS = {
    "20": ["22", "24", "33", "61", "62", "64", "71", "91", "94", "95"],
    "10": ["01", "02", "03", "04", "07", "08", "09", "15", "16", "17", "19", "20", "21", "39", "40", "42", "44", "48", "57", "63", "65", "69", "70", "72", "73", "76", "82", "83", "87"],
    "05": ["06", "10", "11", "12", "23", "25", "26", "27", "28", "29", "31", "32", "35", "38", "47", "50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "68", "74", "75", "84", "85", "86", "88", "89", "90"],
    "00": ["30"]
}

# COMORES
COMOROS_TARIFFS = MADAGASCAR_TARIFFS.copy()

# MAURICE
MAURITIUS_TARIFFS = {
    "30": ["22", "24"],
    "15": ["01", "02", "03", "04", "07", "08", "09", "15", "16", "17", "19", "20", "21", "33", "39", "40", "42", "44", "48", "57", "61", "62", "63", "64", "65", "69", "70", "71", "72", "73", "76", "82", "83", "87", "91", "94", "95"],
    "00": ["06", "10", "11", "12", "23", "25", "26", "27", "28", "29", "30", "31", "32", "35", "38", "47", "50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "68", "74", "75", "84", "85", "86", "88", "89", "90"]
}

# SEYCHELLES
SEYCHELLES_TARIFFS = {
    "25": ["22", "24"],
    "15": ["01", "02", "03", "04", "07", "08", "09", "15", "16", "17", "19", "20", "21", "33", "39", "40", "42", "44", "48", "57", "61", "62", "63", "64", "65", "69", "70", "71", "72", "73", "76", "82", "83", "87", "91", "94", "95"],
    "00": ["06", "10", "11", "12", "23", "25", "26", "27", "28", "29", "30", "31", "32", "35", "38", "47", "50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "68", "74", "75", "84", "85", "86", "88", "89", "90"]
}

# =============================================================================
# CORNE DE L'AFRIQUE
# =============================================================================

# ÉTHIOPIE
ETHIOPIA_TARIFFS = {
    "35": ["22", "24", "33", "61", "62", "64", "71", "91", "94", "95"],
    "25": ["04", "16", "17", "19", "20", "21", "42", "63", "65", "69", "70"],
    "20": ["01", "02", "03", "07", "08", "09", "15", "39", "40", "44", "48", "57", "72", "73", "76", "82", "83", "87"],
    "10": ["06", "10", "11", "12", "23", "32", "35", "38", "47", "50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "68", "74", "75"],
    "05": ["25", "26", "27", "28", "29", "31", "84", "85", "86", "88", "89", "90"],
    "00": ["30"]
}

# DJIBOUTI
DJIBOUTI_TARIFFS = {
    "33": ["22", "24"],
    "26": ["33", "61", "62", "64", "71", "91", "94", "95"],
    "20": ["01", "02", "03", "04", "07", "08", "09", "15", "16", "17", "19", "20", "21", "39", "40", "42", "44", "48", "57", "63", "65", "69", "70", "72", "73", "76", "82", "83", "87"],
    "08": ["06", "10", "11", "12", "23", "32", "35", "38", "47", "50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "68", "74", "75"],
    "05": ["25", "26", "27", "28", "29", "31", "84", "85", "86", "88", "89", "90"],
    "00": ["30"]
}

# ÉRYTHRÉE
ERITREA_TARIFFS = {
    "25": ["22", "24", "33", "61", "62", "64", "71", "91", "94", "95"],
    "12": ["01", "02", "03", "04", "07", "08", "09", "15", "16", "17", "19", "20", "21", "39", "40", "42", "44", "48", "57", "63", "65", "69", "70", "72", "73", "76", "82", "83", "87"],
    "05": ["06", "10", "11", "12", "23", "32", "35", "38", "47", "50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "68", "74", "75"],
    "02": ["25", "26", "27", "28", "29", "30", "31", "84", "85", "86", "88", "89", "90"],
    "00": []
}

# SOMALIE
SOMALIA_TARIFFS = {
    "25": ["22", "24", "33", "61", "62", "64", "71", "91", "94", "95"],
    "10": ["01", "02", "03", "04", "07", "08", "09", "15", "16", "17", "19", "20", "21", "39", "40", "42", "44", "48", "57", "63", "65", "69", "70", "72", "73", "76", "82", "83", "87"],
    "05": ["06", "10", "11", "12", "23", "25", "26", "27", "28", "29", "31", "32", "35", "38", "47", "50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "68", "74", "75", "84", "85", "86", "88", "89", "90"],
    "00": ["30"]
}

# SOUDAN
SUDAN_TARIFFS = {
    "40": ["22", "24"],
    "25": ["33", "61", "62", "64", "71", "91", "94", "95"],
    "15": ["01", "02", "03", "04", "07", "08", "09", "15", "16", "17", "19", "20", "21", "39", "40", "42", "44", "48", "57", "63", "65", "69", "70", "72", "73", "76", "82", "83", "87"],
    "03": ["06", "10", "11", "12", "23", "25", "26", "27", "28", "29", "30", "31", "32", "35", "38", "47", "50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "68", "74", "75", "84", "85", "86", "88", "89", "90"],
    "00": []
}

# =============================================================================
# AUTRES
# =============================================================================

# SÃO TOMÉ-ET-PRÍNCIPE
SAO_TOME_TARIFFS = {
    "30": ["22", "24"],
    "20": ["33", "61", "62", "64", "71", "91", "94", "95"],
    "10": ["01", "02", "03", "04", "07", "08", "09", "15", "16", "17", "19", "20", "21", "39", "40", "42", "44", "48", "57", "63", "65", "69", "70", "72", "73", "76", "82", "83", "87"],
    "05": ["06", "10", "11", "12", "23", "25", "26", "27", "28", "29", "31", "32", "35", "38", "47", "50", "51", "52", "53", "54", "55", "56", "58", "59", "60", "68", "74", "75", "84", "85", "86", "88", "89", "90"],
    "00": ["30"]
}

# =============================================================================
# MAPPING CODE PAYS ISO-2 -> TARIFS
# =============================================================================

COUNTRY_TARIFFS = {
    # Afrique du Nord
    "DZ": ALGERIA_TARIFFS,
    "MA": MOROCCO_TARIFFS,
    "TN": TUNISIA_TARIFFS,
    "EG": EGYPT_TARIFFS,
    "LY": LIBYA_TARIFFS,
    "MR": MAURITANIA_TARIFFS,
    
    # CEDEAO
    "BJ": BENIN_TARIFFS,
    "BF": BURKINA_FASO_TARIFFS,
    "CV": CAPE_VERDE_TARIFFS,
    "CI": IVORY_COAST_TARIFFS,
    "GM": GAMBIA_TARIFFS,
    "GH": GHANA_TARIFFS,
    "GN": GUINEA_TARIFFS,
    "GW": GUINEA_BISSAU_TARIFFS,
    "LR": LIBERIA_TARIFFS,
    "ML": MALI_TARIFFS,
    "NE": NIGER_TARIFFS,
    "NG": NIGERIA_TARIFFS,
    "SN": SENEGAL_TARIFFS,
    "SL": SIERRA_LEONE_TARIFFS,
    "TG": TOGO_TARIFFS,
    
    # CEMAC
    "CM": CAMEROON_TARIFFS,
    "CF": CENTRAL_AFRICAN_REP_TARIFFS,
    "TD": CHAD_TARIFFS,
    "CG": CONGO_TARIFFS,
    "GQ": EQUATORIAL_GUINEA_TARIFFS,
    "GA": GABON_TARIFFS,
    
    # EAC
    "BI": BURUNDI_TARIFFS,
    "KE": KENYA_TARIFFS,
    "RW": RWANDA_TARIFFS,
    "SS": SOUTH_SUDAN_TARIFFS,
    "TZ": TANZANIA_TARIFFS,
    "UG": UGANDA_TARIFFS,
    "CD": DRC_TARIFFS,
    
    # SACU/SADC
    "ZA": SOUTH_AFRICA_TARIFFS,
    "BW": BOTSWANA_TARIFFS,
    "LS": LESOTHO_TARIFFS,
    "NA": NAMIBIA_TARIFFS,
    "SZ": ESWATINI_TARIFFS,
    "AO": ANGOLA_TARIFFS,
    "MZ": MOZAMBIQUE_TARIFFS,
    "ZM": ZAMBIA_TARIFFS,
    "ZW": ZIMBABWE_TARIFFS,
    "MW": MALAWI_TARIFFS,
    "MG": MADAGASCAR_TARIFFS,
    "KM": COMOROS_TARIFFS,
    "MU": MAURITIUS_TARIFFS,
    "SC": SEYCHELLES_TARIFFS,
    
    # Corne de l'Afrique
    "ET": ETHIOPIA_TARIFFS,
    "DJ": DJIBOUTI_TARIFFS,
    "ER": ERITREA_TARIFFS,
    "SO": SOMALIA_TARIFFS,
    "SD": SUDAN_TARIFFS,
    
    # Autres
    "ST": SAO_TOME_TARIFFS,
}


def get_country_tariff_rate(country_code: str, hs_chapter: str) -> Optional[float]:
    """
    Obtenir le taux de douane officiel pour un pays et un chapitre HS
    """
    if country_code not in COUNTRY_TARIFFS:
        return None
    
    country_tariffs = COUNTRY_TARIFFS[country_code]
    hs_chapter = hs_chapter.zfill(2)
    
    for rate_str, chapters in country_tariffs.items():
        if hs_chapter in chapters:
            return float(rate_str) / 100
    
    # Taux médian si chapitre non trouvé
    rates = [float(r) for r in country_tariffs.keys() if country_tariffs[r]]
    if rates:
        return sorted(rates)[len(rates)//2] / 100
    
    return 0.15


def get_available_rates(country_code: str) -> List[float]:
    """Liste des taux officiels pour un pays"""
    if country_code not in COUNTRY_TARIFFS:
        return []
    return sorted([float(r) for r in COUNTRY_TARIFFS[country_code].keys()], reverse=True)


def get_tariff_regime(country_code: str) -> str:
    """Identifier le régime tarifaire"""
    regimes = {
        "BJ": "TEC CEDEAO", "BF": "TEC CEDEAO", "CV": "TEC CEDEAO", "CI": "TEC CEDEAO",
        "GM": "TEC CEDEAO", "GH": "TEC CEDEAO", "GN": "TEC CEDEAO", "GW": "TEC CEDEAO",
        "LR": "TEC CEDEAO", "ML": "TEC CEDEAO", "NE": "TEC CEDEAO", "NG": "TEC CEDEAO",
        "SN": "TEC CEDEAO", "SL": "TEC CEDEAO", "TG": "TEC CEDEAO",
        "CM": "TEC CEMAC", "CF": "TEC CEMAC", "TD": "TEC CEMAC", "CG": "TEC CEMAC",
        "GQ": "TEC CEMAC", "GA": "TEC CEMAC",
        "BI": "TEC EAC", "KE": "TEC EAC", "RW": "TEC EAC", "SS": "TEC EAC",
        "TZ": "TEC EAC", "UG": "TEC EAC", "CD": "TEC EAC",
        "ZA": "SACU", "BW": "SACU", "LS": "SACU", "NA": "SACU", "SZ": "SACU",
        "DZ": "National", "MA": "National", "TN": "National", "EG": "National",
        "LY": "National", "MR": "National", "ET": "National", "DJ": "National",
        "ER": "National", "SO": "National", "SD": "National", "AO": "National",
        "MZ": "SADC", "ZM": "COMESA/SADC", "ZW": "SADC", "MW": "SADC",
        "MG": "COI", "KM": "COI", "MU": "COI", "SC": "COI", "ST": "CEEAC"
    }
    return regimes.get(country_code, "National")


def get_country_tariff_info(country_code: str) -> Optional[Dict]:
    """Informations complètes sur les tarifs d'un pays"""
    if country_code not in COUNTRY_TARIFFS:
        return None
    
    country_tariffs = COUNTRY_TARIFFS[country_code]
    
    return {
        "country_code": country_code,
        "regime": get_tariff_regime(country_code),
        "available_rates": get_available_rates(country_code),
        "rate_details": {
            f"{float(rate_str)}%": {
                "rate_decimal": float(rate_str) / 100,
                "chapters": chapters,
                "chapter_count": len(chapters)
            }
            for rate_str, chapters in country_tariffs.items()
        },
        "source": "OMC, CNUCED TRAINS, Administrations douanières nationales",
        "last_updated": "2025-01"
    }
